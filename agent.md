# AITranslator (TreeÂ² Lang)

## Overview

TreeÂ² Lang æ˜¯ä¸€æ¬¾é¢å‘ iOS 18+ / macOS çš„ SwiftUI åº”ç”¨ï¼Œé…å¥—ä¸€ä¸ª `TranslationUIProviderExtension` æ‰©å±•ï¼Œç”¨äºåœ¨ç³»ç»Ÿç¿»è¯‘é¢æ¿ä¸­ç›´æ¥è°ƒç”¨è‡ªå®šä¹‰çš„ LLM åŠ¨ä½œã€‚åº”ç”¨æ”¯æŒå¤šæä¾›å•†å¹¶å‘è¯·æ±‚ã€æµå¼å“åº”ã€TTS è¯­éŸ³æœ—è¯»ï¼Œä»¥åŠåŸºäº diff çš„æ–‡æœ¬å¯¹æ¯”å±•ç¤ºã€‚

## é¡¹ç›®ç»“æ„

```
AITranslator/
â”œâ”€â”€ AITranslator/                    # ä¸»åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ AITranslatorApp.swift        # App å…¥å£ç‚¹
â”‚   â”œâ”€â”€ Info.plist / Entitlements
â”‚   â””â”€â”€ UI/                          # ä¸»åº”ç”¨ç•Œé¢
â”‚       â”œâ”€â”€ RootTabView.swift        # ä¸»å¯¼èˆªï¼ˆHome/Actions/Providers/Settingsï¼‰
â”‚       â”œâ”€â”€ ActionsView.swift        # åŠ¨ä½œåº“ç®¡ç†ç•Œé¢
â”‚       â”œâ”€â”€ ActionDetailView.swift   # åŠ¨ä½œè¯¦æƒ…ç¼–è¾‘
â”‚       â”œâ”€â”€ ProvidersView.swift      # æä¾›å•†é…ç½®ç•Œé¢
â”‚       â”œâ”€â”€ SettingsView.swift       # è®¾ç½®ç•Œé¢ï¼ˆç›®æ ‡è¯­è¨€/TTSé…ç½®ï¼‰
â”‚       â””â”€â”€ PlaceholderTab.swift     # å ä½è§†å›¾
â”œâ”€â”€ ShareCore/                       # è·¨æ¨¡å—å…±äº«é€»è¾‘
â”‚   â”œâ”€â”€ Configuration/
â”‚   â”‚   â”œâ”€â”€ ActionConfig.swift       # åŠ¨ä½œé…ç½®æ¨¡å‹ï¼ˆæ”¯æŒç»“æ„åŒ–è¾“å‡º/diffå¯¹æ¯”ï¼‰
â”‚   â”‚   â”œâ”€â”€ ProviderConfig.swift     # æä¾›å•†é…ç½®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ ProviderCategory.swift   # æä¾›å•†ç±»åˆ«æšä¸¾
â”‚   â”‚   â”œâ”€â”€ AppConfigurationStore.swift # å•ä¾‹é…ç½®ä»“åº“ï¼ˆæ”¯æŒåŒå‘åŒæ­¥ï¼‰
â”‚   â”‚   â”œâ”€â”€ ConfigurationFileManager.swift # é…ç½®æ–‡ä»¶ç®¡ç†ï¼ˆæ”¯æŒæ–‡ä»¶ç›‘æ§ï¼‰
â”‚   â”‚   â”œâ”€â”€ ConfigurationValidator.swift  # é…ç½®éªŒè¯å™¨
â”‚   â”‚   â”œâ”€â”€ ConfigurationService.swift    # é…ç½®å¯¼å…¥/å¯¼å‡ºæœåŠ¡
â”‚   â”‚   â””â”€â”€ TTSConfiguration.swift   # TTS é…ç½®æ¨¡å‹
â”‚   â”œâ”€â”€ Networking/
â”‚   â”‚   â”œâ”€â”€ LLMService.swift         # LLM è¯·æ±‚æœåŠ¡ï¼ˆæ”¯æŒæµå¼/ç»“æ„åŒ–è¾“å‡ºï¼‰
â”‚   â”‚   â”œâ”€â”€ LLMRequestPayload.swift  # è¯·æ±‚è´Ÿè½½æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ LLMServiceError.swift    # é”™è¯¯ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ ProviderExecutionResult.swift # æ‰§è¡Œç»“æœæ¨¡å‹
â”‚   â”‚   â””â”€â”€ TextToSpeechService.swift # TTS è¯­éŸ³åˆæˆæœåŠ¡
â”‚   â”œâ”€â”€ Preferences/
â”‚   â”‚   â”œâ”€â”€ AppPreferences.swift     # åº”ç”¨åå¥½è®¾ç½®ï¼ˆApp Group å…±äº«ï¼‰
â”‚   â”‚   â””â”€â”€ TargetLanguageOption.swift # ç›®æ ‡è¯­è¨€é€‰é¡¹æšä¸¾
â”‚   â”œâ”€â”€ UI/
â”‚   â”‚   â”œâ”€â”€ HomeView.swift           # ä¸»ç•Œé¢ï¼ˆæ”¯æŒ macOS/iOS/æ‰©å±•ï¼‰
â”‚   â”‚   â””â”€â”€ HomeViewModel.swift      # ä¸»ç•Œé¢çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ Utilities/
â”‚   â”‚   â””â”€â”€ TextDiffBuilder.swift    # æ–‡æœ¬å·®å¼‚å¯¹æ¯”ï¼ˆLCSç®—æ³•ï¼‰
â”‚   â””â”€â”€ AppColors.swift              # è‡ªé€‚åº”é…è‰²è¡¨
â”œâ”€â”€ TranslationUI/                   # ç³»ç»Ÿç¿»è¯‘æ‰©å±•
â”‚   â”œâ”€â”€ TranslationProvider.swift    # TranslationUIProviderExtension å…¥å£
â”‚   â””â”€â”€ Info.plist / Entitlements
â””â”€â”€ Workers/
    â””â”€â”€ azureProxyWorker.ts          # Cloudflare Worker ä»£ç†ï¼ˆå¯é€‰ï¼‰
```

## æ ¸å¿ƒåŠŸèƒ½

### 1. å¤šåŠ¨ä½œæ”¯æŒ

- **ç¿»è¯‘**ï¼šæ™ºèƒ½ç¿»è¯‘ï¼Œè‡ªåŠ¨æ£€æµ‹è¯­è¨€å¹¶åœ¨ç›®æ ‡è¯­è¨€ä¸è‹±è¯­ä¹‹é—´åˆ‡æ¢
- **æ€»ç»“**ï¼šç²¾ç®€æ€»ç»“ï¼Œä¿ç•™å…³é”®ä¿¡æ¯
- **æ‰“ç£¨**ï¼šåŸè¯­è¨€æ¶¦è‰²ï¼Œæå‡è¡¨è¾¾è´¨é‡
- **è¯­æ³•æ£€æŸ¥**ï¼šç»“æ„åŒ–è¾“å‡ºï¼Œåˆ†ç¦»æ¶¦è‰²ç»“æœä¸é”™è¯¯åˆ†æï¼ˆä½¿ç”¨ JSON Schemaï¼‰
- **å¥å­åˆ†æ**ï¼šè¯­æ³•è§£æä¸æ­é…ç§¯ç´¯

### 2. åŠ¨ä½œé…ç½®æ¨¡å‹ï¼ˆActionConfigï¼‰

- `usageScenes`ï¼šæ§åˆ¶åŠ¨ä½œåœ¨ App/æ‰©å±•åªè¯»/æ‰©å±•å¯ç¼–è¾‘ åœºæ™¯ä¸‹çš„å¯è§æ€§
- `showsDiff`ï¼šå¯ç”¨ diff å¯¹æ¯”å±•ç¤ºï¼ˆåŸæ–‡åˆ é™¤çº¿ + æ–°å¢é«˜äº®ï¼‰
- `structuredOutput`ï¼šJSON Schema ç»“æ„åŒ–è¾“å‡ºé…ç½®ï¼ˆprimaryField + additionalFieldsï¼‰

### 3. æµå¼ä¸ç»“æ„åŒ–å“åº”

- **æµå¼å“åº”**ï¼šé€šè¿‡ SSE å®æ—¶æ˜¾ç¤ºç”Ÿæˆå†…å®¹
- **ç»“æ„åŒ–è¾“å‡º**ï¼šAzure OpenAI çš„ `response_format: json_schema` æ”¯æŒ
- **å¤šæä¾›å•†å¹¶å‘**ï¼šåŒæ—¶å‘å¤šä¸ªé…ç½®çš„æä¾›å•†å‘é€è¯·æ±‚

### 4. TTS è¯­éŸ³æœ—è¯»

- é›†æˆ Azure OpenAI TTS APIï¼ˆgpt-4o-mini-ttsï¼‰
- æ”¯æŒè‡ªå®šä¹‰ç«¯ç‚¹/API Key é…ç½®
- å¯é€‰ä½¿ç”¨é»˜è®¤é…ç½®æˆ–è‡ªå®šä¹‰é…ç½®

### 5. ç›®æ ‡è¯­è¨€è®¾ç½®

- æ”¯æŒ 8 ç§è¯­è¨€ï¼šåº”ç”¨è¯­è¨€/è‹±è¯­/ç®€ä½“ä¸­æ–‡/æ—¥è¯­/éŸ©è¯­/æ³•è¯­/å¾·è¯­/è¥¿ç­ç‰™è¯­
- åŠ¨æ€æ›´æ–°åŠ¨ä½œ Prompt æ¨¡æ¿

### 6. å·®å¼‚å¯¹æ¯”ï¼ˆTextDiffBuilderï¼‰

- åŸºäº LCSï¼ˆæœ€é•¿å…¬å…±å­åºåˆ—ï¼‰ç®—æ³•
- åˆ†ç¦»åŸæ–‡æ®µè½ï¼ˆåˆ é™¤æ ‡è®°ï¼‰ä¸ä¿®è®¢æ®µè½ï¼ˆæ–°å¢é«˜äº®ï¼‰
- è‡ªé€‚åº”äº®/æš—æ¨¡å¼é…è‰²

## æ ¸å¿ƒç»„ä»¶

### AppConfigurationStore

å•ä¾‹é…ç½®ä»“åº“ï¼Œç®¡ç†åŠ¨ä½œä¸æä¾›å•†é…ç½®ï¼š

- å¯åŠ¨æ—¶æ³¨å…¥é»˜è®¤æä¾›å•†ï¼ˆAzure OpenAI model-router + gpt-5-nanoï¼‰
- é¢„ç½® 5 ä¸ªåŠ¨ä½œæ¨¡æ¿
- å“åº”ç›®æ ‡è¯­è¨€å˜æ›´ï¼Œè‡ªåŠ¨æ›´æ–°å—ç®¡ç†çš„åŠ¨ä½œ Prompt
- **åŒå‘åŒæ­¥**ï¼šUI ä¿®æ”¹è‡ªåŠ¨ä¿å­˜åˆ°æ–‡ä»¶ï¼Œæ–‡ä»¶å˜æ›´è‡ªåŠ¨é‡æ–°åŠ è½½åˆ°å†…å­˜
- **é…ç½®éªŒè¯**ï¼šæ›´æ–°å’ŒåŠ è½½æ—¶è‡ªåŠ¨éªŒè¯é…ç½®å®Œæ•´æ€§
- **æ–‡ä»¶ç›‘æ§**ï¼šé€šè¿‡ DispatchSource ç›‘æ§é…ç½®æ–‡ä»¶çš„å¤–éƒ¨ä¿®æ”¹

### HomeView / HomeViewModel

å…±äº«ä¸»ç•Œé¢ï¼ŒåŒæ—¶ç”¨äºä¸»åº”ç”¨ä¸ç³»ç»Ÿç¿»è¯‘æ‰©å±•ï¼š

- è¾“å…¥æ¡†å¯æŠ˜å /å±•å¼€
- åŠ¨ä½œ Chip é€‰æ‹©å™¨
- æä¾›å•†ç»“æœå¡ç‰‡ï¼ˆskeleton/streaming/success/failure çŠ¶æ€ï¼‰
- æ”¯æŒå¤åˆ¶/æ›¿æ¢/è¯­éŸ³æœ—è¯»
- è‡ªåŠ¨ç²˜è´´å¹¶æ‰§è¡ŒåŠŸèƒ½

### LLMService

åŸºäº URLSession çš„å¼‚æ­¥ç½‘ç»œå®¢æˆ·ç«¯ï¼š

- å¹¶å‘ TaskGroup æ‰§è¡Œå¤šæä¾›å•†è¯·æ±‚
- æ”¯æŒ SSE æµå¼å“åº”è§£æ
- ç»“æ„åŒ–è¾“å‡º JSON è§£æ
- ç»Ÿä¸€çš„ ProviderExecutionResult ç»“æœå°è£…

### TranslationProviderExtension

ç³»ç»Ÿç¿»è¯‘æ‰©å±•å…¥å£ï¼Œæç®€å°è£…ï¼š

- è¯»å– App Group åå¥½è®¾ç½®
- å‘ˆç° `HomeView(context:)`
- æ”¯æŒæ›¿æ¢åŸæ–‡ï¼ˆallowsReplacementï¼‰

### AppPreferences

åº”ç”¨åå¥½è®¾ç½®ç®¡ç†ï¼š

- ä½¿ç”¨ App Group å…±äº«å­˜å‚¨
- ç®¡ç†ç›®æ ‡è¯­è¨€ã€TTS é…ç½®
- å“åº” UserDefaults å˜æ›´é€šçŸ¥

## é…ç½®è¯»å†™æµç¨‹

### é…ç½®æ¶æ„æ¦‚è¿°

é…ç½®ç³»ç»Ÿé‡‡ç”¨å¤šå±‚æ¶æ„ï¼Œå®ç°äº† JSON é…ç½®æ–‡ä»¶ä¸å†…å­˜æ¨¡å‹ä¹‹é—´çš„åŒå‘è½¬æ¢ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æŒä¹…åŒ–å±‚                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  App Group Container                                                â”‚
â”‚  â””â”€â”€ Configurations/                                                â”‚
â”‚      â”œâ”€â”€ Default.json          <- é¦–æ¬¡å¯åŠ¨ä» Bundle å¤åˆ¶            â”‚
â”‚      â”œâ”€â”€ MyConfig.json         <- ç”¨æˆ·è‡ªå®šä¹‰é…ç½®                    â”‚
â”‚      â””â”€â”€ ...                                                        â”‚
â”‚                                                                     â”‚
â”‚  UserDefaults (App Group)                                           â”‚
â”‚  â”œâ”€â”€ current_config_name       <- å½“å‰æ¿€æ´»çš„é…ç½®åç§°                 â”‚
â”‚  â”œâ”€â”€ target_language           <- ç›®æ ‡è¯­è¨€åå¥½                      â”‚
â”‚  â””â”€â”€ tts_*                     <- TTS ç›¸å…³è®¾ç½®                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â–²
                               â”‚ è¯»/å†™
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ–‡ä»¶ç®¡ç†å±‚                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ConfigurationFileManager                                           â”‚
â”‚  â”œâ”€â”€ listConfigurations()      -> [ConfigurationFileInfo]           â”‚
â”‚  â”œâ”€â”€ loadConfiguration(named:) -> AppConfiguration                  â”‚
â”‚  â”œâ”€â”€ saveConfiguration(_:name:)                                     â”‚
â”‚  â””â”€â”€ deleteConfiguration(named:)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â–²
                               â”‚ AppConfiguration (ä¸­é—´æ¨¡å‹)
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        é…ç½®ä»“åº“å±‚                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  AppConfigurationStore (å•ä¾‹)                                        â”‚
â”‚  â”œâ”€â”€ @Published actions: [ActionConfig]                             â”‚
â”‚  â”œâ”€â”€ @Published providers: [ProviderConfig]                         â”‚
â”‚  â”œâ”€â”€ updateActions(_:)         -> æ›´æ–°å†…å­˜ + è‡ªåŠ¨ä¿å­˜               â”‚
â”‚  â”œâ”€â”€ updateProviders(_:)       -> æ›´æ–°å†…å­˜ + è‡ªåŠ¨ä¿å­˜               â”‚
â”‚  â””â”€â”€ switchConfiguration(to:)  -> åˆ‡æ¢é…ç½®æ–‡ä»¶                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â–²
                               â”‚ ObservableObject
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        UI å±‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ActionsView / ProvidersView / SettingsView                         â”‚
â”‚  â””â”€â”€ ç»‘å®šåˆ° AppConfigurationStore.shared                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®æ•°æ®æ¨¡å‹

| æ¨¡å‹               | èŒè´£                                    | å­˜å‚¨ä½ç½®     |
| ------------------ | --------------------------------------- | ------------ |
| `AppConfiguration` | JSON é…ç½®æ–‡ä»¶çš„ Codable ä¸­é—´æ¨¡å‹        | .json æ–‡ä»¶   |
| `ActionConfig`     | åŠ¨ä½œçš„å†…å­˜æ¨¡å‹ï¼ˆå« UUIDï¼‰               | å†…å­˜         |
| `ProviderConfig`   | æä¾›å•†çš„å†…å­˜æ¨¡å‹ï¼ˆå« UUIDï¼‰             | å†…å­˜         |
| `AppPreferences`   | åå¥½è®¾ç½®ï¼ˆç›®æ ‡è¯­è¨€ã€TTSã€å½“å‰é…ç½®åç§°ï¼‰ | UserDefaults |

### å¯åŠ¨æ—¶åŠ è½½æµç¨‹

```swift
// AppConfigurationStore.init()
1. è°ƒç”¨ loadConfiguration()
   â”‚
   â”œâ”€ 2. ä» UserDefaults è¯»å– currentConfigName
   â”‚
   â”œâ”€ 3. å°è¯•åŠ è½½æŒ‡å®šåç§°çš„é…ç½®æ–‡ä»¶
   â”‚     â””â”€ tryLoadConfiguration(named:)
   â”‚         â”œâ”€ configFileManager.loadConfiguration(named:)
   â”‚         â”‚   â””â”€ JSON è§£ç  -> AppConfiguration
   â”‚         â””â”€ applyLoadedConfiguration(_:)
   â”‚             â”œâ”€ è§£æ providers -> [ProviderConfig]
   â”‚             â”‚   â””â”€ ProviderEntry.toProviderConfig(name:)
   â”‚             â”œâ”€ è§£æ actions -> [ActionConfig]
   â”‚             â”‚   â””â”€ ActionEntry.toActionConfig(providerMap:)
   â”‚             â””â”€ åº”ç”¨ç›®æ ‡è¯­è¨€åˆ° prompt
   â”‚                 â””â”€ applyTargetLanguage(_:targetLanguage:)
   â”‚
   â”œâ”€ 4. è‹¥åŠ è½½å¤±è´¥ï¼Œå°è¯•åŠ è½½å…¶ä»–å¯ç”¨é…ç½®
   â”‚     â””â”€ configFileManager.listConfigurations()
   â”‚
   â””â”€ 5. è‹¥æ— å¯ç”¨é…ç½®ï¼Œåˆ›å»ºç©ºé…ç½®
         â””â”€ createEmptyConfiguration()
```

**é¦–æ¬¡å¯åŠ¨ç‰¹æ®Šå¤„ç†**ï¼š

- `ConfigurationFileManager` åˆå§‹åŒ–æ—¶æ£€æŸ¥ `Default.json` æ˜¯å¦å­˜åœ¨
- è‹¥ä¸å­˜åœ¨ï¼Œä» Bundle ä¸­çš„ `DefaultConfiguration.json` å¤åˆ¶åˆ° App Group å®¹å™¨

### UI ä¿®æ”¹åçš„ä¿å­˜æµç¨‹

```swift
// ç”¨æˆ·åœ¨ UI ä¿®æ”¹ Action æˆ– Provider å
1. UI è°ƒç”¨ store.updateActions(_:) æˆ– store.updateProviders(_:)
   â”‚
   â”œâ”€ 2. åº”ç”¨ç›®æ ‡è¯­è¨€æ¨¡æ¿ï¼ˆä»… Actionsï¼‰
   â”‚     â””â”€ applyTargetLanguage(_:targetLanguage:)
   â”‚
   â”œâ”€ 3. æ›´æ–°å†…å­˜ä¸­çš„ @Published å±æ€§
   â”‚     â””â”€ self.actions = adjusted / self.providers = providers
   â”‚
   â””â”€ 4. è‡ªåŠ¨è°ƒç”¨ saveConfiguration()
         â”‚
         â”œâ”€ 5. buildCurrentConfiguration()
         â”‚     â”œâ”€ æ„å»º providerEntries: [String: ProviderEntry]
         â”‚     â”‚   â””â”€ ProviderEntry.from(provider) -> (name, entry)
         â”‚     â”œâ”€ æ„å»º actionEntries: [ActionEntry]
         â”‚     â”‚   â””â”€ ActionEntry.from(action, providerNames:)
         â”‚     â””â”€ ç»„è£… AppConfiguration
         â”‚
         â””â”€ 6. configFileManager.saveConfiguration(_:name:)
               â””â”€ JSON ç¼–ç  -> å†™å…¥ .json æ–‡ä»¶
```

### æ•°æ®è½¬æ¢ç»†èŠ‚

#### Provider åç§°ä¸ UUID æ˜ å°„

é…ç½®æ–‡ä»¶ä¸­ Provider ä½¿ç”¨ **åç§°** æ ‡è¯†ï¼Œå†…å­˜æ¨¡å‹ä½¿ç”¨ **UUID**ã€‚è½¬æ¢è¿‡ç¨‹ï¼š

**åŠ è½½æ—¶**ï¼ˆåç§° â†’ UUIDï¼‰ï¼š

```swift
// åœ¨ applyLoadedConfiguration(_:) ä¸­
var providerNameToID: [String: UUID] = [:]
for (name, entry) in config.providers {
    if let provider = entry.toProviderConfig(name: name) {
        providerNameToID[name] = provider.id  // ç”Ÿæˆæ–° UUID
    }
}
// Action ä½¿ç”¨æ­¤æ˜ å°„è§£æ providerIDs
action.toActionConfig(providerMap: providerNameToID)
```

**ä¿å­˜æ—¶**ï¼ˆUUID â†’ åç§°ï¼‰ï¼š

```swift
// åœ¨ buildCurrentConfiguration() ä¸­
var providerIDToName: [UUID: String] = [:]
for provider in providers {
    let (name, entry) = ProviderEntry.from(provider)
    providerIDToName[provider.id] = uniqueName
}
// Action ä½¿ç”¨æ­¤æ˜ å°„å¯¼å‡º provider åç§°åˆ—è¡¨
ActionEntry.from(action, providerNames: providerIDToName)
```

#### ç›®æ ‡è¯­è¨€åŠ¨æ€æ›´æ–°

å—ç®¡ç†çš„åŠ¨ä½œï¼ˆTranslate/Summarize/Sentence Analysis ç­‰ï¼‰åœ¨ä»¥ä¸‹åœºæ™¯è‡ªåŠ¨æ›´æ–° Promptï¼š

1. **åŠ è½½é…ç½®æ—¶**ï¼š`applyTargetLanguage()` æ£€æµ‹ Prompt æ˜¯å¦åŒ¹é…æ¨¡æ¿
2. **ç”¨æˆ·åˆ‡æ¢è¯­è¨€æ—¶**ï¼šé€šè¿‡ Combine è®¢é˜… `preferences.$targetLanguage` è‡ªåŠ¨è§¦å‘æ›´æ–°

```swift
preferences.$targetLanguage
    .sink { [weak self] option in
        let updated = applyTargetLanguage(self.actions, targetLanguage: option)
        self.actions = updated
        self.saveConfiguration()
    }
```

### é…ç½®æœåŠ¡ (ConfigurationService)

æä¾›é…ç½®çš„å¯¼å…¥/å¯¼å‡ºåŠŸèƒ½ï¼Œç”¨äºé…ç½®è¿ç§»æˆ–å¤‡ä»½ï¼š

| æ–¹æ³•                             | ç”¨é€”                                |
| -------------------------------- | ----------------------------------- |
| `exportConfiguration()`          | å¯¼å‡ºå½“å‰é…ç½®ä¸º JSON Data            |
| `importConfiguration()`          | ä» JSON è§£æ AppConfiguration       |
| `applyConfiguration()`           | å°†é…ç½®åº”ç”¨åˆ° Store å’Œ Preferences   |
| `validateCurrentConfiguration()` | éªŒè¯å½“å‰é…ç½®å¹¶è¿”å› ValidationResult |

### é…ç½®åŒæ­¥ä¸éªŒè¯æœºåˆ¶

#### åŒå‘åŒæ­¥æ¶æ„

é…ç½®ç³»ç»Ÿå®ç°äº† UI â†” å†…å­˜ â†” æ–‡ä»¶ çš„å®Œæ•´åŒå‘åŒæ­¥ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        åŒå‘åŒæ­¥æµç¨‹                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    updateActions()    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   UI    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ ConfigStore     â”‚              â”‚
â”‚  â”‚         â”‚                       â”‚ (å†…å­˜)           â”‚              â”‚
â”‚  â”‚         â”‚ <â”€â”€â”€@Publishedâ”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                             â”‚                       â”‚
â”‚                                    saveConfiguration()              â”‚
â”‚                                             â”‚                       â”‚
â”‚                                             â–¼                       â”‚
â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚                                    â”‚  JSON æ–‡ä»¶       â”‚              â”‚
â”‚                                    â”‚  (.json)        â”‚              â”‚
â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                             â”‚                       â”‚
â”‚                               DispatchSource ç›‘æ§                    â”‚
â”‚                                             â”‚                       â”‚
â”‚                                             â–¼                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ fileChange      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ ConfigFile      â”‚                  â”‚
â”‚  â”‚ Publisher       â”‚           â”‚ Manager         â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚           â”‚                                                         â”‚
â”‚           â”‚ Combine è®¢é˜…                                             â”‚
â”‚           â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ handleFileChangeâ”‚â”€â”€â”€â”€> reloadCurrentConfiguration()              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ–‡ä»¶ç›‘æ§æœºåˆ¶

`ConfigurationFileManager` ä½¿ç”¨ `DispatchSource` ç›‘æ§é…ç½®æ–‡ä»¶å˜åŒ–ï¼š

```swift
// å¯åŠ¨ç›‘æ§
configFileManager.startMonitoring(configurationNamed: "Default")

// æ¥æ”¶æ–‡ä»¶å˜åŒ–äº‹ä»¶
configFileManager.fileChangePublisher
    .debounce(for: .seconds(0.5), scheduler: DispatchQueue.main)
    .sink { event in
        switch event.changeType {
        case .modified:
            store.reloadCurrentConfiguration()
        case .deleted:
            // åˆ‡æ¢åˆ°å…¶ä»–é…ç½®æˆ–åˆ›å»ºç©ºé…ç½®
        case .renamed:
            // å°è¯•é‡æ–°åŠ è½½
        }
    }
```

**é˜²æ­¢ä¿å­˜å¾ªç¯**ï¼š

- ä¿å­˜å‰è®°å½• `lastSaveTimestamp`
- æ”¶åˆ°æ–‡ä»¶å˜æ›´äº‹ä»¶æ—¶æ£€æŸ¥æ—¶é—´æˆ³ï¼Œå¿½ç•¥è‡ªèº«è§¦å‘çš„å˜æ›´
- ä½¿ç”¨ 0.5 ç§’ debounce åˆå¹¶è¿ç»­äº‹ä»¶

#### é…ç½®éªŒè¯å™¨ (ConfigurationValidator)

éªŒè¯å™¨æ£€æŸ¥é…ç½®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ï¼š

| éªŒè¯é¡¹             | ä¸¥é‡æ€§  | è¯´æ˜                                            |
| ------------------ | ------- | ----------------------------------------------- |
| ç‰ˆæœ¬æ ¼å¼           | Error   | æ£€æŸ¥ç‰ˆæœ¬å·æ ¼å¼æ˜¯å¦ä¸º X.Y.Z                      |
| ç‰ˆæœ¬å…¼å®¹æ€§         | Error   | ä»…æ”¯æŒ 1.x.x ç‰ˆæœ¬                               |
| Provider åˆ†ç±»      | Error   | æ£€æŸ¥ category æ˜¯å¦ä¸ºå·²çŸ¥ç±»å‹                    |
| Endpoint URL       | Error   | æ£€æŸ¥ URL æ ¼å¼æ˜¯å¦æœ‰æ•ˆ                           |
| Provider å¼•ç”¨      | Error   | Action å¼•ç”¨çš„ Provider å¿…é¡»å­˜åœ¨                 |
| Deployment å¼•ç”¨    | Error   | Action å¼•ç”¨çš„ Deployment å¿…é¡»åœ¨ Provider ä¸­å­˜åœ¨ |
| ç©º Token           | Warning | Provider çš„ API Token ä¸ºç©º                      |
| æ—  Deployment      | Warning | Provider æ²¡æœ‰é…ç½®ä»»ä½• Deployment                |
| æœªä½¿ç”¨çš„ Provider  | Warning | Provider æœªè¢«ä»»ä½• Action å¼•ç”¨                   |
| Action æ—  Provider | Warning | Action æ²¡æœ‰é…ç½®ä»»ä½• Provider                    |
| é‡å¤ Action åç§°   | Warning | å­˜åœ¨åŒå Action                                 |

#### éªŒè¯ç»“æœæ¨¡å‹

```swift
public struct ConfigurationValidationResult {
    public let issues: [ConfigurationValidationIssue]

    public var isValid: Bool { !hasErrors }
    public var hasErrors: Bool   // åŒ…å« Error çº§åˆ«é—®é¢˜
    public var hasWarnings: Bool // åŒ…å« Warning çº§åˆ«é—®é¢˜

    public var errors: [ConfigurationValidationIssue]
    public var warnings: [ConfigurationValidationIssue]
}

public enum ConfigurationValidationIssue {
    case providerNotFound(providerID: String, referencedBy: String)
    case deploymentNotFound(deployment: String, provider: String, referencedBy: String)
    case unsupportedVersion(version: String, supportedRange: String)
    // ... æ›´å¤šéªŒè¯é—®é¢˜

    public var severity: ValidationSeverity // .error æˆ– .warning
    public var message: String              // äººç±»å¯è¯»çš„æè¿°
}
```

#### éªŒè¯æ—¶æœº

| æ—¶æœº              | éªŒè¯çº§åˆ« | è¡Œä¸º                                  |
| ----------------- | -------- | ------------------------------------- |
| åŠ è½½é…ç½®æ—¶        | å®Œæ•´éªŒè¯ | Error é˜»æ­¢åŠ è½½ï¼ŒWarning ä»…è®°å½•æ—¥å¿—    |
| UI æ›´æ–° Actions   | å†…å­˜éªŒè¯ | è¿”å› ValidationResultï¼ŒError é˜»æ­¢ä¿å­˜ |
| UI æ›´æ–° Providers | å†…å­˜éªŒè¯ | è¿”å› ValidationResultï¼ŒError é˜»æ­¢ä¿å­˜ |
| å¯¼å…¥é…ç½®æ—¶        | å®Œæ•´éªŒè¯ | Error è¿”å›å¤±è´¥ç»“æœ                    |
| ä¿å­˜é…ç½®æ—¶        | å®Œæ•´éªŒè¯ | Error é˜»æ­¢ä¿å­˜ï¼ˆå¯ç”¨ forceSave è·³è¿‡ï¼‰ |

#### ä½¿ç”¨ç¤ºä¾‹

```swift
// æ›´æ–° Actions å¹¶è·å–éªŒè¯ç»“æœ
let result = store.updateActions(newActions)
if let result, result.hasWarnings {
    // æ˜¾ç¤ºè­¦å‘Šç»™ç”¨æˆ·
    for warning in result.warnings {
        print("âš ï¸ \(warning.message)")
    }
}

// æ‰‹åŠ¨éªŒè¯å½“å‰é…ç½®
let validationResult = store.validateCurrentConfiguration()
if validationResult.hasErrors {
    // å¤„ç†é”™è¯¯
}

// å¼ºåˆ¶ä¿å­˜ï¼ˆè·³è¿‡éªŒè¯ï¼‰
store.forceSaveConfiguration()

// é‡æ–°åŠ è½½é…ç½®ï¼ˆä»æ–‡ä»¶ï¼‰
store.reloadCurrentConfiguration()
```

### æ•°æ®ä¸€è‡´æ€§ä¿éšœ

1. **è‡ªåŠ¨ä¿å­˜**ï¼šæ¯æ¬¡ `updateActions()` æˆ– `updateProviders()` è°ƒç”¨åç«‹å³æŒä¹…åŒ–
2. **App Group å…±äº«**ï¼šä¸»åº”ç”¨ä¸æ‰©å±•å…±äº«åŒä¸€é…ç½®ç›®å½•
3. **UserDefaults åŒæ­¥**ï¼šè°ƒç”¨ `defaults.synchronize()` ç¡®ä¿è·¨è¿›ç¨‹å¯è§
4. **Combine è®¢é˜…**ï¼šåå¥½å˜æ›´è‡ªåŠ¨è§¦å‘é…ç½®æ›´æ–°
5. **æ–‡ä»¶ç›‘æ§**ï¼šé€šè¿‡ DispatchSource ç›‘æ§å¤–éƒ¨æ–‡ä»¶ä¿®æ”¹ï¼Œè‡ªåŠ¨é‡æ–°åŠ è½½
6. **é˜²æ­¢ä¿å­˜å¾ªç¯**ï¼šè®°å½•ä¿å­˜æ—¶é—´æˆ³ï¼Œå¿½ç•¥è‡ªèº«è§¦å‘çš„æ–‡ä»¶å˜æ›´äº‹ä»¶
7. **éªŒè¯ä¿éšœ**ï¼šåŠ è½½å’Œä¿å­˜æ—¶éªŒè¯é…ç½®å®Œæ•´æ€§ï¼ŒError çº§åˆ«é—®é¢˜é˜»æ­¢æ“ä½œ

## é»˜è®¤é…ç½®

| åŠ¨ä½œ     | åŠŸèƒ½æè¿°                       | ç‰¹æ€§                         |
| -------- | ------------------------------ | ---------------------------- |
| ç¿»è¯‘     | ç¿»è¯‘åˆ°ç›®æ ‡è¯­è¨€ï¼ŒåŒè¯­è¨€æ—¶è½¬è‹±è¯­ | åŠ¨æ€ Prompt                  |
| æ€»ç»“     | ç”¨ç›®æ ‡è¯­è¨€æ€»ç»“æ–‡æœ¬             | åŠ¨æ€ Prompt                  |
| æ‰“ç£¨     | åŸè¯­è¨€æ¶¦è‰²                     | showsDiff                    |
| è¯­æ³•æ£€æŸ¥ | æ¶¦è‰² + é”™è¯¯åˆ†æ                | showsDiff + structuredOutput |
| å¥å­åˆ†æ | è¯­æ³•è§£æä¸æ­é…ç§¯ç´¯             | åŠ¨æ€ Prompt                  |

é»˜è®¤æä¾›å•†ï¼š

- Azure OpenAI `model-router`ï¼ˆè‡ªåŠ¨è·¯ç”±ï¼‰
- Azure OpenAI `gpt-5-nano`ï¼ˆè½»é‡æ¨¡å‹ï¼‰

## æ‰©å±•æ‰§è¡Œæµç¨‹

1. æ‰©å±•å¯åŠ¨æ—¶è¯»å– App Group åå¥½è®¾ç½®
2. æ¥æ”¶ `TranslationUIProviderContext`ï¼Œè‡ªåŠ¨å¡«å……è¾“å…¥æ¡†
3. è‡ªåŠ¨è§¦å‘é»˜è®¤åŠ¨ä½œæ‰§è¡Œ
4. `HomeViewModel` æ ¹æ®åŠ¨ä½œé…ç½®ç­›é€‰æä¾›å•†
5. `LLMService` å¹¶å‘å‘é€è¯·æ±‚ï¼Œæµå¼/éæµå¼åˆ†åˆ«å¤„ç†
6. å®æ—¶æ›´æ–° UI çŠ¶æ€ï¼ˆskeleton â†’ streaming â†’ success/failureï¼‰
7. æ”¯æŒå¤åˆ¶/æ›¿æ¢/è¯­éŸ³æœ—è¯»æ“ä½œ

## ä»£ç é£æ ¼

éµå¾ª Airbnb Swift Style Guideï¼š

- ä¸€ä¸ªæ–‡ä»¶ä¸€ä¸ªé¡¶å±‚ç±»å‹
- ç§æœ‰è¾…åŠ©ç±»å‹ä½¿ç”¨åµŒå¥—å£°æ˜ï¼ˆå¦‚ `SettingsView.LanguagePickerView`ï¼‰
- 2 ç©ºæ ¼ç¼©è¿›ï¼Œæœ€å¤§è¡Œå®½ 100 å­—ç¬¦
- trailing comma è§„åˆ™
- å¤šè¡Œæ¡ä»¶è¯­å¥åœ¨å…³é”®å­—åæ¢è¡Œ

## åç»­æ¼”è¿›å»ºè®®

1. **æŒä¹…åŒ–**ï¼šå°†é…ç½®æŒä¹…åŒ–åˆ° App Groupï¼Œæ•æ„Ÿä¿¡æ¯æ”¾å…¥ Keychain
2. **æä¾›å•†é…ç½® UI**ï¼šå®ç°æä¾›å•†æ–°å¢/ç¼–è¾‘ç•Œé¢
3. **åŠ¨ä½œç¼–è¾‘ UI**ï¼šå®Œå–„åŠ¨ä½œåˆ›å»º/ç¼–è¾‘æµç¨‹
4. **æµ‹è¯•è¦†ç›–**ï¼šè¡¥å…… URLProtocol Mock å•å…ƒæµ‹è¯•ã€UI æµ‹è¯•
5. **æœ¬åœ°åŒ–**ï¼šå®Œå–„å¤šè¯­è¨€æ”¯æŒ
6. **æ—¥å¿—ç³»ç»Ÿ**ï¼šåŠ å…¥å¯è§‚æµ‹æ€§ä¸è°ƒè¯•æ—¥å¿—
7. **iCloud åŒæ­¥**ï¼šè·¨è®¾å¤‡é…ç½®åŒæ­¥

## å‚è€ƒèµ„æ–™

- Apple: [Preparing your app to be the default translation app](https://developer.apple.com/documentation/TranslationUIProvider/Preparing-your-app-to-be-the-default-translation-app)
- Apple TranslationUIProvider / ExtensionKit æ–‡æ¡£ä¸ WWDC24 ç›¸å…³ Session
- [Airbnb Swift Style Guide](https://github.com/airbnb/swift)

## AI Agent å¼€å‘å·¥å…·

### XcodeBuildMCP

æœ¬é¡¹ç›®æ”¯æŒé€šè¿‡ [XcodeBuildMCP](https://github.com/nicepkg/xcodebuild-mcp) å®ç° AI Agent è‡ªåŠ¨åŒ–å¼€å‘ã€‚XcodeBuildMCP æ˜¯ä¸€ä¸ª Model Context Protocol (MCP) æœåŠ¡å™¨ï¼Œå…è®¸ AI Agent ç›´æ¥ä¸ Xcode é¡¹ç›®äº¤äº’ã€‚

#### å¯ç”¨èƒ½åŠ›

| èƒ½åŠ›         | å·¥å…·ç¤ºä¾‹                                  | ç”¨é€”                                     |
| ------------ | ----------------------------------------- | ---------------------------------------- |
| **æ„å»º**     | `build_sim`, `build_macos`                | ç¼–è¯‘é¡¹ç›®åˆ°æ¨¡æ‹Ÿå™¨æˆ– macOS                 |
| **è¿è¡Œ**     | `build_run_sim`, `launch_app_sim`         | æ„å»ºå¹¶è¿è¡Œï¼Œæˆ–ç›´æ¥å¯åŠ¨åº”ç”¨               |
| **æˆªå›¾**     | `screenshot`                              | æ•è·æ¨¡æ‹Ÿå™¨å½“å‰å±å¹•                       |
| **æ—¥å¿—**     | `start_sim_log_cap`, `stop_sim_log_cap`   | å¯åŠ¨/åœæ­¢æ—¥å¿—æ•è·ä¼šè¯                    |
| **UI æè¿°**  | `describe_ui`                             | è·å–å®Œæ•´çš„è§†å›¾å±‚æ¬¡ç»“æ„ï¼ˆç”¨äºè‡ªåŠ¨åŒ–æµ‹è¯•ï¼‰ |
| **UI äº¤äº’**  | `tap`, `type_text`, `swipe`, `long_press` | æ¨¡æ‹Ÿç”¨æˆ·æ“ä½œ                             |
| **é¡¹ç›®ç®¡ç†** | `discover_projs`, `list_schemes`          | å‘ç°é¡¹ç›®å’Œ scheme                        |

#### å…¸å‹å·¥ä½œæµç¨‹

```bash
# 1. è®¾ç½®ä¼šè¯é»˜è®¤å€¼
session-set-defaults {
  "projectPath": "/Users/zander/Work/AITranslator/AITranslator.xcodeproj",
  "scheme": "AITranslator",
  "simulatorId": "<simulator-uuid>",
  "useLatestOS": true
}

# 2. æ„å»ºå¹¶è¿è¡Œ
build_run_sim

# 3. å¼€å¯æ—¥å¿—æ•è·
start_sim_log_cap { "bundleId": "com.zanderwang.AITranslator" }
# è¿”å› sessionId

# 4. æˆªå›¾æŸ¥çœ‹å½“å‰çŠ¶æ€
screenshot

# 5. è·å– UI å±‚æ¬¡ç»“æ„ï¼ˆç”¨äºç²¾ç¡®ç‚¹å‡»åæ ‡ï¼‰
describe_ui

# 6. æ¨¡æ‹Ÿç”¨æˆ·æ“ä½œ
tap { "label": "Send" }           # é€šè¿‡ accessibility label ç‚¹å‡»
tap { "x": 200, "y": 300 }        # é€šè¿‡åæ ‡ç‚¹å‡»
type_text { "text": "Hello" }     # è¾“å…¥æ–‡å­—

# 7. åœæ­¢æ—¥å¿—æ•è·å¹¶æŸ¥çœ‹
stop_sim_log_cap { "logSessionId": "<session-id>" }
```

#### ä½¿ç”¨åœºæ™¯

1. **è‡ªåŠ¨åŒ– UI æµ‹è¯•**ï¼šAI Agent å¯ä»¥è‡ªåŠ¨æ„å»ºã€è¿è¡Œåº”ç”¨å¹¶é€šè¿‡æˆªå›¾éªŒè¯ UI æ•ˆæœ
2. **å¿«é€Ÿè¿­ä»£**ï¼šä¿®æ”¹ä»£ç åç«‹å³ç¼–è¯‘éªŒè¯ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ Xcode
3. **é—®é¢˜è¯Šæ–­**ï¼šé€šè¿‡æ—¥å¿—æ•è·å’Œ UI æè¿°å¿«é€Ÿå®šä½é—®é¢˜
4. **è‡ªåŠ¨åŒ–æ¼”ç¤º**ï¼šå½•åˆ¶è§†é¢‘æˆ–æˆªå›¾ç”¨äºæ–‡æ¡£

#### æ³¨æ„äº‹é¡¹

- æˆªå›¾æ˜¯é™æ€çš„ï¼Œæ— æ³•æ•è·åŠ¨ç”»æ•ˆæœ
- æ—¥å¿—æ•è·éœ€è¦åº”ç”¨ä½¿ç”¨ `os_log` è¾“å‡ºç»“æ„åŒ–æ—¥å¿—æ‰èƒ½çœ‹åˆ°å†…å®¹
- `describe_ui` è¿”å› accessibility ä¿¡æ¯ï¼Œç”¨äºç²¾ç¡®å®šä½ UI å…ƒç´ åæ ‡
- å»ºè®®åœ¨ç‚¹å‡»å‰å…ˆè°ƒç”¨ `describe_ui` è·å–ç²¾ç¡®åæ ‡ï¼Œè€Œä¸æ˜¯ä»æˆªå›¾çŒœæµ‹

## åº”ç”¨è¡Œä¸ºå®æµ‹åˆ†æ

> æœ¬ç« èŠ‚åŸºäº XcodeBuildMCP è‡ªåŠ¨åŒ–æµ‹è¯•çš„å®é™…è¿è¡Œç»“æœï¼Œè®°å½•åº”ç”¨çš„çœŸå®è¡Œä¸ºè¡¨ç°ã€‚

### æµ‹è¯•ç¯å¢ƒ

| é¡¹ç›®     | å€¼                       |
| -------- | ------------------------ |
| æ¨¡æ‹Ÿå™¨   | iPhone 17 Pro (iOS 26.1) |
| Xcode    | 26.1 (Build 17B55)       |
| MCP å·¥å…· | XcodeBuildMCP v1.15.1    |
| æµ‹è¯•æ—¶é—´ | 2026-01-01               |

### UI ç»“æ„å®æµ‹

#### Tab Bar å¯¼èˆª

åº”ç”¨é‡‡ç”¨åº•éƒ¨ Tab Bar å¯¼èˆªï¼ŒåŒ…å« 4 ä¸ªé¡µç­¾ï¼š

| Tab       | å›¾æ ‡        | åŠŸèƒ½         | accessibility label |
| --------- | ----------- | ------------ | ------------------- |
| Home      | house.fill  | ä¸»ç¿»è¯‘ç•Œé¢   | ï¼ˆæœªæš´éœ²ï¼‰          |
| Actions   | list.bullet | åŠ¨ä½œåˆ—è¡¨ç®¡ç† | ï¼ˆæœªæš´éœ²ï¼‰          |
| Providers | cpu         | æä¾›å•†é…ç½®   | ï¼ˆæœªæš´éœ²ï¼‰          |
| Settings  | gear        | è®¾ç½®         | ï¼ˆæœªæš´éœ²ï¼‰          |

**å‘ç°é—®é¢˜**ï¼šTab Bar æŒ‰é’®æœªè®¾ç½® `accessibilityLabel`ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•éœ€é€šè¿‡åæ ‡ç‚¹å‡»ã€‚

#### Home é¡µé¢ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Set as default translation app]  â† æç¤ºæ¨ªå¹…
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Type or paste text here...     â”‚    â”‚ â† å¯å±•å¼€è¾“å…¥æ¡†
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                         â”‚
â”‚  [Translate] [Sentence..] [Grammar..]   â”‚ â† åŠ¨ä½œé€‰æ‹©å™¨ï¼ˆæ°´å¹³æ»šåŠ¨ï¼‰
â”‚  [Polish] [Sentence Analysis]           â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Azure OpenAI model-router      â”‚    â”‚ â† æä¾›å•†ç»“æœå¡ç‰‡
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚    â”‚
â”‚  â”‚  å“åº”å†…å®¹                        â”‚    â”‚
â”‚  â”‚                                 â”‚    â”‚
â”‚  â”‚  [Copy] [Replace] [ğŸ”Š]          â”‚    â”‚ â† æ“ä½œæŒ‰é’®
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®è§‚å¯Ÿ**ï¼š

- è¾“å…¥æ¡†é»˜è®¤æŠ˜å ä¸ºå•è¡Œï¼Œç‚¹å‡»åå±•å¼€ä¸ºå¤šè¡Œ
- åŠ¨ä½œé€‰æ‹©å™¨ä¸ºæ°´å¹³æ»šåŠ¨è§†å›¾ï¼Œ"Polish" å’Œ "Sentence Analysis" åˆå§‹ä¸å¯è§
- æä¾›å•†å¡ç‰‡æ˜¾ç¤ºæµå¼å“åº”çŠ¶æ€

### æ ¸å¿ƒæµç¨‹éªŒè¯

#### ç¿»è¯‘æµç¨‹

1. **è¾“å…¥**ï¼šåœ¨æ–‡æœ¬æ¡†è¾“å…¥ "Hello, how are you today?"
2. **é€‰æ‹©åŠ¨ä½œ**ï¼šç‚¹å‡» "Translate" Chip
3. **å‘é€**ï¼šç‚¹å‡» Send æŒ‰é’®
4. **å“åº”**ï¼šæ˜¾ç¤ºæµå¼å“åº”ï¼Œæœ€ç»ˆç»“æœ "ä½ å¥½ï¼Œä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿ"
5. **å“åº”æ—¶é—´**ï¼š2.6 - 4.3 ç§’ï¼ˆå–å†³äºç½‘ç»œå’Œæ¨¡å‹ï¼‰

#### è¯­æ³•æ£€æŸ¥æµç¨‹ï¼ˆç»“æ„åŒ–è¾“å‡ºï¼‰

1. **è¾“å…¥**ï¼šå«è¯­æ³•é”™è¯¯çš„æ–‡æœ¬ "She don't likes apples. Me and him goes to school everyday."
2. **é€‰æ‹©åŠ¨ä½œ**ï¼šç‚¹å‡» "Grammar Check" Chip
3. **å“åº”ç»“æ„**ï¼š
   ```
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  polished_text:                     â”‚
   â”‚  She doesn't like apples. He and I  â”‚
   â”‚  go to school every day.            â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚  grammar_analysis:                  â”‚
   â”‚  â€¢ "She don't" â†’ "She doesn't"      â”‚
   â”‚  â€¢ "likes" â†’ "like"                 â”‚
   â”‚  â€¢ "Me and him" â†’ "He and I"        â”‚
   â”‚  â€¢ ...                              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   ```
4. **å“åº”æ—¶é—´**ï¼šçº¦ 8.7 ç§’ï¼ˆç»“æ„åŒ–è¾“å‡ºæ¯”æ™®é€šç¿»è¯‘æ›´æ…¢ï¼‰

#### ç›®æ ‡è¯­è¨€åˆ‡æ¢

1. **è¿›å…¥ Settings**ï¼šç‚¹å‡» Settings Tab
2. **é€‰æ‹©è¯­è¨€**ï¼šç‚¹å‡» "Target Language" â†’ é€‰æ‹© "ç®€ä½“ä¸­æ–‡"
3. **éªŒè¯ç”Ÿæ•ˆ**ï¼šè¿”å› Home é¡µï¼ŒPrompt æ¨¡æ¿è‡ªåŠ¨æ›´æ–°
4. **å½±å“èŒƒå›´**ï¼šTranslateã€Summarizeã€Sentence Analysis ç­‰åŠ¨æ€ Prompt åŠ¨ä½œ

### æ€§èƒ½åŸºå‡†

| æ“ä½œ     | å¹³å‡è€—æ—¶   | å¤‡æ³¨               |
| -------- | ---------- | ------------------ |
| åº”ç”¨å¯åŠ¨ | < 1s       | å†·å¯åŠ¨åˆ°å¯äº¤äº’     |
| ç®€å•ç¿»è¯‘ | 2.6 - 4.3s | 10 è¯ä»¥å†…          |
| è¯­æ³•æ£€æŸ¥ | 8 - 10s    | ç»“æ„åŒ–è¾“å‡ºï¼Œå«åˆ†æ |
| Tab åˆ‡æ¢ | < 0.1s     | å³æ—¶å“åº”           |
| é…ç½®åŠ è½½ | < 0.5s     | ä» JSON æ–‡ä»¶åŠ è½½   |

### å·²çŸ¥é—®é¢˜ä¸æ”¹è¿›å»ºè®®

#### é—®é¢˜ 1ï¼šTab Bar Accessibility

**ç°è±¡**ï¼šTab æŒ‰é’®æ— æ³•é€šè¿‡ `tap { "label": "xxx" }` ç‚¹å‡»
**å½±å“**ï¼šè‡ªåŠ¨åŒ–æµ‹è¯•éœ€è¦ä½¿ç”¨åæ ‡ç‚¹å‡»ï¼Œé™ä½æµ‹è¯•ç¨³å®šæ€§
**å»ºè®®**ï¼šä¸º Tab æŒ‰é’®æ·»åŠ  `.accessibilityLabel("Home")` ç­‰

#### é—®é¢˜ 2ï¼šåŠ¨ä½œé€‰æ‹©å™¨å¯è§æ€§

**ç°è±¡**ï¼š5 ä¸ªåŠ¨ä½œåœ¨å•è¡Œæ˜¾ç¤ºï¼Œåä¸¤ä¸ªéœ€è¦æ»šåŠ¨æ‰èƒ½çœ‹åˆ°
**å½±å“**ï¼šç”¨æˆ·å¯èƒ½ä¸çŸ¥é“å­˜åœ¨æ›´å¤šåŠ¨ä½œ
**å»ºè®®**ï¼š

- æ·»åŠ æ»šåŠ¨æŒ‡ç¤ºå™¨
- æˆ–é‡‡ç”¨å¤šè¡Œ Grid å¸ƒå±€
- æˆ–æ·»åŠ ã€Œæ›´å¤šã€æŒ‰é’®

#### é—®é¢˜ 3ï¼šæŒä¹…æç¤ºæ¨ªå¹…

**ç°è±¡**ï¼š"Set as default translation app" æ¨ªå¹…å§‹ç»ˆæ˜¾ç¤º
**å½±å“**ï¼šå ç”¨å±å¹•ç©ºé—´ï¼Œç”¨æˆ·æ— æ³•å…³é—­
**å»ºè®®**ï¼š

- æ·»åŠ å…³é—­æŒ‰é’®
- ç”¨æˆ·è®¾ä¸ºé»˜è®¤åè‡ªåŠ¨éšè—
- æˆ–è®°ä½ç”¨æˆ·çš„å…³é—­åå¥½

### æµ‹è¯•è¦†ç›–å»ºè®®

åŸºäºå®æµ‹åˆ†æï¼Œå»ºè®®è¡¥å……ä»¥ä¸‹æµ‹è¯•åœºæ™¯ï¼š

| ç±»å‹       | æµ‹è¯•åœºæ™¯                     | ä¼˜å…ˆçº§ |
| ---------- | ---------------------------- | ------ |
| åŠŸèƒ½æµ‹è¯•   | ç©ºè¾“å…¥å¤„ç†                   | P1     |
| åŠŸèƒ½æµ‹è¯•   | è¶…é•¿æ–‡æœ¬è¾“å…¥ï¼ˆ>1000 å­—ç¬¦ï¼‰   | P1     |
| åŠŸèƒ½æµ‹è¯•   | ç½‘ç»œæ–­å¼€æ—¶çš„é”™è¯¯å¤„ç†         | P1     |
| åŠŸèƒ½æµ‹è¯•   | å¤šæä¾›å•†å¹¶å‘å“åº”             | P2     |
| åŠŸèƒ½æµ‹è¯•   | TTS è¯­éŸ³æœ—è¯»                 | P2     |
| åŠŸèƒ½æµ‹è¯•   | diff å¯¹æ¯”æ˜¾ç¤ºï¼ˆPolish åŠ¨ä½œï¼‰ | P2     |
| UI æµ‹è¯•    | æ·±è‰²æ¨¡å¼é€‚é…                 | P2     |
| UI æµ‹è¯•    | æ¨ªå±å¸ƒå±€                     | P3     |
| æ€§èƒ½æµ‹è¯•   | å¤§é‡å†å²è®°å½•æ—¶çš„æ»šåŠ¨æ€§èƒ½     | P3     |
| ç¨³å®šæ€§æµ‹è¯• | è¿ç»­æ‰§è¡Œ 50 æ¬¡ç¿»è¯‘           | P3     |

### æµ‹è¯•å‘½ä»¤é€ŸæŸ¥

```bash
# æ„å»ºå¹¶è¿è¡Œåˆ°æ¨¡æ‹Ÿå™¨
mcp_xcodebuildmcp_build_run_sim

# æˆªå›¾å½“å‰çŠ¶æ€
mcp_xcodebuildmcp_screenshot

# è·å– UI å±‚æ¬¡ç»“æ„
mcp_xcodebuildmcp_describe_ui

# ç‚¹å‡»æ“ä½œ
mcp_xcodebuildmcp_tap { "x": 200, "y": 100 }  # åæ ‡ç‚¹å‡»
mcp_xcodebuildmcp_tap { "label": "Send" }      # Label ç‚¹å‡»

# è¾“å…¥æ–‡æœ¬
mcp_xcodebuildmcp_type_text { "text": "Hello" }

# æ»šåŠ¨æ“ä½œ
mcp_xcodebuildmcp_gesture { "preset": "scroll-down" }
```
